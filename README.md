# 🏃 Telegram-бот: база знаний бегового клуба

Бот работает как база знаний: упражнения, методички, терминология, комплексы тренировок. Поиск по названию и ключевым словам, удобное меню и навигация кнопками.

---

## 1. Архитектура проекта

```
┌─────────────────────────────────────────────────────────────────┐
│                         main.py                                  │
│  (точка входа, создание Application, run_polling)                │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      handlers/                                    │
│  menu.py      → /start, кнопки главного меню                     │
│  exercises.py → раздел «Упражнения», callback выбора              │
│  education.py → раздел «Образование», список материалов          │
│  complexes.py → раздел «Комплексы», структура тренировки         │
│  terminology.py → раздел «Терминология», ввод термина             │
│  search.py    → универсальный поиск и роутинг текста              │
│  keyboards.py → Reply- и Inline-клавиатуры                       │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      database/                                    │
│  base.py   → абстрактный интерфейс BaseDB                        │
│  json_db.py   → реализация на JSON-файлах (data/*.json)          │
│  sqlite_db.py → реализация на SQLite (data/running_club.db)      │
│  __init__.py  → выбор реализации по config.STORAGE_MODE          │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  config.py  → BOT_TOKEN, STORAGE_MODE, пути к данным, приветствие │
│  data/      → exercises.json, complexes.json, education.json,     │
│               terminology.json (и/или running_club.db)           │
└─────────────────────────────────────────────────────────────────┘
```

- **Long polling**: используется по умолчанию (`application.run_polling()`), webhook не нужен.
- **Модульность**: логика разнесена по `handlers/` и `database/`, общий контракт в `database/base.py`.
- **Два варианта хранения**: JSON (по умолчанию) или SQLite; переключение через `config.STORAGE_MODE` или переменную окружения `STORAGE_MODE`.

---

## 2. Структура файлов

```
running_club_bot/
├── main.py                 # Запуск бота
├── config.py               # Токен, режим хранения, пути
├── requirements.txt
├── README.md
├── data/
│   ├── exercises.json      # Упражнения
│   ├── complexes.json      # Комплексы тренировок
│   ├── education.json      # Методички и материалы
│   ├── terminology.json    # Термины и определения
│   └── running_club.db     # (если STORAGE_MODE=sqlite)
├── database/
│   ├── __init__.py         # Фабрика get_db()
│   ├── base.py             # Интерфейс BaseDB
│   ├── json_db.py          # Хранение в JSON
│   └── sqlite_db.py        # Хранение в SQLite
├── handlers/
│   ├── __init__.py         # Регистрация всех обработчиков
│   ├── keyboards.py        # Клавиатуры
│   ├── menu.py             # /start, главное меню
│   ├── exercises.py        # Упражнения
│   ├── education.py        # Образование
│   ├── complexes.py        # Комплексы
│   ├── terminology.py      # Терминология
│   └── search.py           # Поиск и роутинг текста
└── scripts/
    └── seed_sqlite_from_json.py   # Заполнение SQLite из JSON
```

---

## 3. Пример базы данных

### JSON (режим `json`)

**Упражнения** (`data/exercises.json`):

```json
{
  "exercises": [
    {
      "id": "ex-1",
      "name": "Бег трусцой",
      "description": "Лёгкий бег в комфортном темпе для разминки или восстановления.",
      "link": "https://t.me/your_channel/1",
      "keywords": ["разминка", "восстановление", "лёгкий бег"]
    }
  ]
}
```

**Комплексы** (`data/complexes.json`):

```json
{
  "complexes": [
    {
      "id": "comp-1",
      "name": "Утренняя разминка 15 мин",
      "description": "Короткий комплекс перед утренней пробежкой.",
      "structure": "1. Суставная разминка — 3 мин\n2. Динамическая растяжка — 5 мин\n...",
      "duration_minutes": 15
    }
  ]
}
```

**Образование** (`data/education.json`): поля `id`, `title`, `description`, `link`, `category`.  
**Терминология** (`data/terminology.json`): массив объектов с полями `term`, `definition`.

### SQLite (режим `sqlite`)

Таблицы: `exercises` (id, name, description, link, keywords), `education`, `complexes`, `terminology`.  
Пример заполнения из JSON — скрипт `scripts/seed_sqlite_from_json.py`.

---

## 4. Функции бота (MVP)

| Раздел | Действие |
|--------|----------|
| **/start** | Приветствие и главное меню с кнопками |
| **📚 Упражнения** | Запрос ввода → поиск по названию/ключевым словам → карточка или список кнопок |
| **🧠 Образование** | Список материалов → выбор → описание и ссылка |
| **🏃 Комплексы** | Список комплексов → выбор → описание и структура тренировки |
| **📖 Терминология** | Ввод термина → вывод определения (fallback, если не найдено) |
| **🔍 Поиск** | Универсальный поиск по упражнениям, терминам, комплексам |
| **◀️ Назад** | Возврат в главное меню |

- Поиск по ключевым словам реализован в `json_db` и через LIKE в `sqlite_db`.
- Если упражнение или термин не найдены — сообщение с подсказкой (fallback).

---

## 5. Как запустить локально

### Требования

- Python 3.10+ (или 3.9+ с учётом типов)
- Аккаунт Telegram, токен бота от [@BotFather](https://t.me/BotFather)

### Шаги

1. **Клонировать/скопировать проект** и перейти в каталог:
   ```bash
   cd running_club_bot
   ```

2. **Создать виртуальное окружение** (рекомендуется):
   ```bash
   python3 -m venv venv
   source venv/bin/activate   # Windows: venv\Scripts\activate
   ```

3. **Установить зависимости**:
   ```bash
   pip install -r requirements.txt
   ```

4. **Задать токен бота**:
   - В `config.py`: заменить `YOUR_BOT_TOKEN_HERE` на токен от BotFather, **или**
   - В терминале: `export RUNNING_BOT_TOKEN=123456:ABC-...`

5. **Запуск (режим JSON по умолчанию)**:
   ```bash
   python main.py
   ```
   Данные берутся из `data/*.json`. Папка `data/` и примеры файлов уже в репозитории.

6. **Опционально: режим SQLite**
   - Заполнить БД из JSON:
     ```bash
     python scripts/seed_sqlite_from_json.py
     ```
   - Включить SQLite:
     ```bash
     export STORAGE_MODE=sqlite
     python main.py
     ```
   Либо в `config.py` задать `STORAGE_MODE = "sqlite"`.

После запуска в логах будет строка вида: `Режим хранения: json. Запуск long polling...`. Откройте бота в Telegram и нажмите **Start** или отправьте `/start`.

---

## Расширение данных

- **JSON**: редактируйте файлы в `data/` (сохраняйте кодировку UTF-8 и структуру, как в примерах выше).
- **SQLite**: после изменения JSON снова выполните `python scripts/seed_sqlite_from_json.py` или добавляйте записи в БД своими скриптами.

Токен и ссылки на канал/методички лучше не коммитить в открытый репозиторий; используйте переменные окружения или отдельный конфиг.
